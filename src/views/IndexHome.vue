<template>
    <!-- å¯¼èˆªæ  -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-gray-200">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="#" class="flex items-center space-x-2">
                        <svg class="h-8 w-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.161 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12c0-5.523-4.477-10-10-10z">
                            </path>
                        </svg>
                        <span class="text-xl font-bold text-secondary">Youloge</span>
                    </a>
                </div>

                <!-- ä¸»å¯¼èˆª - æ¡Œé¢ç«¯ -->
                <nav class="hidden md:flex items-center space-x-8">
                    <router-link to="video" class="text-gray-600 hover:text-primary transition-colors">è§†é¢‘</router-link>
                    <router-link to="article"
                        class="text-gray-600 hover:text-primary transition-colors">æ–°é—»</router-link>
                    <router-link to="goods" class="text-gray-600 hover:text-primary transition-colors">è´­ç‰©</router-link>
                    <router-link to="drive" class="text-gray-600 hover:text-primary transition-colors">ç½‘ç›˜</router-link>
                </nav>

                <!-- ç™»å½•/æ³¨å†ŒæŒ‰é’® -->
                <div class="flex items-center space-x-4">
                    <a href="javascript:;" @click="onLogin"
                        class="hidden md:block text-gray-100 bg-gray-800 px-2  py-3 hover:bg-gray-600 rounded-sm hover:text-gray-200 transition-colors">ç™»å½•Â·æ³¨å†Œ</a>
                    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
                    <a href="javascript:;" @click="onLogin" class="md:hidden text-gray-600 ">
                        <YouIcon name="mdi-light:menu" size="40" color="gray"></YouIcon>
                    </a>
                </div>
            </div>
        </div>
    </header>
    <main class="">
        <!-- è‹±é›„åŒºåŸŸ -->
        <section class="bg-gradient-to-b from-neutral to-white py-16 md:py-24">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="max-w-4xl mx-auto text-center">
                    <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-secondary mb-6 leading-tight">
                        ä¸ºå¼€å‘è€…æ‰“é€ çš„<br class="md:hidden">åŸºå»ºæœåŠ¡å¹³å°
                    </h1>
                    <p class="text-xl text-gray-600 mb-8 text-balance" @click="onCaptcha">
                        å¿«é€Ÿã€é›¶æƒé™ã€é›¶æˆæœ¬
                    </p>
                    <!-- å¿«é€Ÿç»Ÿè®¡ -->
                    <div class="flex flex-wrap justify-center gap-x-8 gap-y-2 text-sm text-gray-500">
                        <div><span class="font-semibold text-secondary">100M+</span> æ³¨å†Œç”¨æˆ·</div>
                        <div><span class="font-semibold text-secondary">40M+</span> ä¸“æ æ–‡ç« </div>
                        <div><span class="font-semibold text-secondary">190+</span> éŸ³è§†é¢‘ç”µå½±</div>
                        <div><span class="font-semibold text-secondary">190+</span> åˆ†äº«èµ„æº</div>
                    </div>
                </div>
            </div>
        </section>
        <!-- ç‰¹æ€§å±•ç¤º -->
        <section id="features" class="py-16 md:py-24">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold text-secondary mb-4">ä¸ºä»€ä¹ˆé€‰æ‹© Youloge?</h2>
                    <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                        æ¥å£å…è´¹ã€èµ„æºå…±äº«ã€å¼€æºå¯æ§ã€å®Œæ•´æƒé™
                    </p>
                </div>
            </div>
            <!-- å®«æ ¼å¡ç‰‡ -->
            <div class="grid md:grid-cols-2 gap-8 px-4">
                <!-- ç‰¹æ€§å¡ç‰‡ 1 -->
                <div class="bg-white p-8 rounded-lg border border-gray-200 card-hover">
                    <div class="w-12 h-12 bg-primary/10 rounded-md flex items-center justify-center mb-6">
                        <YouIcon name="carbon:code" size="40" color="primary"></YouIcon>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 text-secondary">
                        <a href="https://s.apifox.cn/7302e0d5-18da-4730-adc5-4b532b346923" target="_blank">APIæ¥å£&#8594;</a>
                    </h3>
                    <p class="text-gray-600">
                        å¼€æ”¾æ‰€æœ‰æ¥å£ã€æœåŠ¡APIè¯·æ±‚æ–¹å¼
                    </p>
                </div>
                <!-- ç‰¹æ€§å¡ç‰‡ 2 -->
                <div class="bg-white p-8 rounded-lg border border-gray-200 card-hover">
                    <div class="w-12 h-12 bg-primary/10 rounded-md flex items-center justify-center mb-6">
                        <YouIcon name="carbon:mac-command" size="40" color="primary"></YouIcon>
                    </div>
                    <h3 class="text-xl font-semibold mb-3 text-secondary">
                        <a href="https://docs.youloge.com/" target="_blank">
                            æ–‡æ¡£ä¸­å¿ƒ&#8594;
                        </a>
                    </h3>
                    <p class="text-gray-600">
                        å¹³å°é…å¥—ç»„ä»¶æœåŠ¡
                    </p>
                </div>
                <!-- ç‰¹æ€§å¡ç‰‡ 4 -->
            </div>
        </section>
        <!-- è¡ŒåŠ¨å¬å”¤ -->

    </main>
    <footer class=" border-0 border-solid border-t-1 border-gray-300 w-full">
        <div class="mt-2 text-center text-gray-500">
            <a href="https://beian.miit.gov.cn/" class="text-gray no-underline">
                <p>ICPå¤‡æ¡ˆ/è®¸å¯è¯å·ï¼šçš–ICPå¤‡19004549å·</p>
            </a>
            <p>çš–å…¬å®‰å¤‡ 34112402000344</p>
        </div>
    </footer>
</template>
<script setup>
const { success, warning, error, info } = useMessage();
const useYouPlus = YouPlus({
    // debug: 'http://localhost:4173/'
});
console.log('captcha',useYouPlus)
const state = reactive({
    color: '#23ca92', hover: {},
    width: 0, height: 0,
    socket: null,
    pixels: [],
    canvas: null,
    ctx: null,
    isDragging: false,
    initialX: 0,
    initialY: 0,
    currentX: 0,
    currentY: 0,
    scale: 1,
    initialScale: 1,
    startX: 0,
    startY: 0,
    mouseX: 0,
    mouseY: 0,
}), { canvas, color, width, height, hover } = toRefs(state);
// æµ‹è¯•äººæœºéªŒè¯
const onCaptcha = ()=>{
    useYouPlus.useCaptcha().then(res=>{
        console.log(6666,res)
    })

}
const onLogin = () => {
    useYouPlus.useLogin().then(profile => {
        console.log(profile)
        useStorage('profile', profile);
        location.reload()
    }).catch(err => {
        console.log(err)
        warning(err.msg)
    });
};
// éªŒè¯å…¬é’¥

onMounted(async () => {
  try {
    // 1. å…¬é’¥é…ç½®ï¼ˆå·²éªŒè¯åˆè§„ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
    const spkiPem = `-----BEGIN PUBLIC KEY-----
MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEpB+tjwLwqjah7+yANiIh8+mklWsD
/isdEN6ovVa2O77+OSG76XMbuL/gGEuzUw6nLQoCF8tfkaMdHIzlH4BVSw==
-----END PUBLIC KEY-----`;

    // 2. å¾…åŠ å¯†æ˜æ–‡
    const plaintext = "è¿™æ˜¯ä¸€æ®µéœ€è¦åŠ å¯†çš„æ•æ„Ÿæ–‡å­—ï¼š123456";

    // 3. æ¸…ç†å¹¶è§£ç å…¬é’¥ï¼ˆé€»è¾‘ä¸å˜ï¼‰
    const pemClean = spkiPem
      .replace(/-----BEGIN PUBLIC KEY-----/, '')
      .replace(/-----END PUBLIC KEY-----/, '')
      .replace(/\s+/g, '');
    const uint8Array = new Uint8Array(atob(pemClean).split('').map(c => c.charCodeAt(0)));

    // 4. å¯¼å…¥å…¬é’¥ï¼ˆä¸¥æ ¼æŒ‰è§„èŒƒé…ç½®ï¼‰
    const publicKey = await crypto.subtle.importKey(
      'spki',
      uint8Array.buffer,
      { name: 'ECDH', namedCurve: 'P-256' },
      false,
      [] // å…¬é’¥ä»…ç”¨äºå¯†é’¥äº¤æ¢ï¼Œç”¨é€”ä¸ºç©º
    );
    console.log('âœ… å…¬é’¥å¯¼å…¥æˆåŠŸ');

    // 5. ç”Ÿæˆä¸´æ—¶ ECDH å¯†é’¥å¯¹ï¼ˆç”¨é€”ä»… deriveBitsï¼‰
    const tempKeyPair = await crypto.subtle.generateKey(
      { name: 'ECDH', namedCurve: 'P-256' },
      false, // ä¸å¯æå–ï¼Œé¿å…æ ¡éªŒé”™è¯¯
      ['deriveBits'] // ç”¨é€”ï¼šä»…æ´¾ç”ŸåŸå§‹å…±äº«å¯†é’¥ï¼ˆbitsï¼‰
    );
    console.log('âœ… ä¸´æ—¶ ECDH å¯†é’¥å¯¹ç”ŸæˆæˆåŠŸ');

    // ğŸ”¥ æ ¸å¿ƒä¿®æ­£ Step 1ï¼šECDH æ´¾ç”ŸåŸå§‹å…±äº«å¯†é’¥ï¼ˆbitsï¼Œæ‰€æœ‰æµè§ˆå™¨æ”¯æŒï¼‰
    const sharedBits = await crypto.subtle.deriveBits(
      { name: 'ECDH', public: publicKey },
      tempKeyPair.privateKey,
      256 // å…±äº«å¯†é’¥é•¿åº¦ï¼š256ä½ï¼ˆä¸ P-256 æ›²çº¿åŒ¹é…ï¼‰
    );
    console.log('âœ… åŸå§‹å…±äº«å¯†é’¥ï¼ˆbitsï¼‰ç”ŸæˆæˆåŠŸ');

    // ğŸ”¥ æ ¸å¿ƒä¿®æ­£ Step 2ï¼šå°†å…±äº«å¯†é’¥ï¼ˆbitsï¼‰å¯¼å…¥ä¸ºã€ŒåŸå§‹å¯†é’¥ã€ï¼ˆç”¨äº HKDF æ´¾ç”Ÿï¼‰
    const rawSharedKey = await crypto.subtle.importKey(
      'raw', // å¯†é’¥æ ¼å¼ï¼šåŸå§‹äºŒè¿›åˆ¶
      sharedBits,
      { name: 'HKDF' }, // ç®—æ³•ï¼šHKDFï¼ˆç”¨äºåç»­æ´¾ç”Ÿï¼‰
      false, // ä¸å¯æå–
      ['deriveKey'] // ç”¨é€”ï¼šä»…ç”¨äºæ´¾ç”Ÿ AES å¯†é’¥
    );
    console.log('âœ… åŸå§‹å…±äº«å¯†é’¥å¯¼å…¥æˆåŠŸ');

    // ğŸ”¥ æ ¸å¿ƒä¿®æ­£ Step 3ï¼šHKDF æ´¾ç”Ÿ AES-256-GCM å¯†é’¥ï¼ˆç”¨é€”å®Œå…¨åŒ¹é…ï¼‰
    const salt = crypto.getRandomValues(new Uint8Array(16));
    const info = new TextEncoder().encode('AES-GCM-Encryption-Context');
    const aesKey = await crypto.subtle.deriveKey(
      {
        name: 'HKDF',
        salt: salt,
        info: info,
        hash: 'SHA-256'
      },
      rawSharedKey, // å¯¼å…¥åçš„åŸå§‹å…±äº«å¯†é’¥
      { name: 'AES-GCM', length: 256 },
      true,
      ['encrypt', 'decrypt'] // AES å¯†é’¥ç”¨é€”ï¼šåŠ å¯†+è§£å¯†ï¼ˆå®Œå…¨åŒ¹é…ï¼‰
    );
    console.log('âœ… AES-256-GCM å¯†é’¥ç”ŸæˆæˆåŠŸ');

    // 6. AES-GCM åŠ å¯†æ˜æ–‡ï¼ˆé€»è¾‘ä¸å˜ï¼‰
    const encoder = new TextEncoder();
    const data = encoder.encode(plaintext);
    const iv = crypto.getRandomValues(new Uint8Array(12)); // 12å­—èŠ‚ IVï¼ˆæ¨èï¼‰

    const encrypted = await crypto.subtle.encrypt(
      { name: 'AES-GCM', iv: iv },
      aesKey,
      data
    );

    // 7. å¤„ç†åŠ å¯†ç»“æœï¼ˆåç«¯è§£å¯†å¿…éœ€ï¼‰
    const encryptedArray = new Uint8Array(encrypted);
    const ciphertext = encryptedArray.slice(0, encryptedArray.length - 16);
    const authTag = encryptedArray.slice(encryptedArray.length - 16);
    const tempPublicKeyRaw = await crypto.subtle.exportKey('spki', tempKeyPair.publicKey);

    const encryptResult = {
      ciphertext: btoa(String.fromCharCode(...ciphertext)),
      iv: btoa(String.fromCharCode(...iv)),
      authTag: btoa(String.fromCharCode(...authTag)),
      tempPublicKey: btoa(String.fromCharCode(...new Uint8Array(tempPublicKeyRaw))),
      salt: btoa(String.fromCharCode(...salt))
    };

    console.log('ğŸ‰ åŠ å¯†å®Œå…¨æˆåŠŸï¼ä¼ é€’ç»™åç«¯çš„æ•°æ®ï¼š', encryptResult);
    // å‘é€ç»™åç«¯ï¼šawait axios.post('/api/decrypt', encryptResult);

  } catch (err) {
    console.error('âŒ åŠ å¯†æµç¨‹å¤±è´¥ï¼š', err.message || err);
    console.error('âŒ é”™è¯¯è¯¦æƒ…ï¼š', err.stack);
  }
});
</script>

<style>
#container {
    overflow: hidden;
}

#canvas {
    position: absolute;
    top: 0;
    left: 0;
    opacity: 1;
    visibility: visible;
    image-rendering: pixelated;
    /* transform-origin: 0px 0px 0px; */
    box-shadow: 0px 0px 0px 8px #9C27B0
}
</style>